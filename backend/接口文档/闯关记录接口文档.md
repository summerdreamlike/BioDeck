# 闯关记录接口文档

## 概述
- 模块：闯关记录（关卡尝试）
- 作用：记录学生在各关卡的闯关结果（成败、失败次数）并对外提供查询接口
- 认证：所有接口需要携带 JWT（Authorization: Bearer <token>）
- 前缀：`/api/v1`

## 数据模型（后端）
- 表：`level_records`
  - `student_id`：学生用户ID
  - `level_name`：关卡名称
  - `is_success`：最近一次尝试是否成功（0/1）
  - `failure_count`：累计失败次数（仅在失败时递增）
  - `last_attempt_time`：最近尝试时间
  - 唯一约束：`UNIQUE(student_id, level_name)`

## 接口清单

### 获取当前用户全部闯关记录
- 方法：GET
- 路径：`/levels/records`
- 认证：需要
- 请求参数：无
- 响应示例：
```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "records": [
      {
        "id": 1,
        "student_id": 1001,
        "level_name": "有丝分裂",
        "is_success": 0,
        "failure_count": 3,
        "last_attempt_time": "2025-09-05 10:20:30",
        "created_at": "2025-09-01 08:00:00"
      }
    ]
  }
}
```

### 获取当前用户指定关卡的闯关记录
- 方法：GET
- 路径：`/levels/records/{level_name}`
- 认证：需要
- 请求参数：
  - `level_name`（path）：关卡名称
- 响应示例：
```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "id": 1,
    "student_id": 1001,
    "level_name": "有丝分裂",
    "is_success": 0,
    "failure_count": 3,
    "last_attempt_time": "2025-09-05 10:20:30",
    "created_at": "2025-09-01 08:00:00"
  }
}
```

### 提交（记录）一次闯关尝试
- 方法：POST
- 路径：`/levels/records`
- 认证：需要
- 请求体：
```json
{
  "level_name": "有丝分裂",
  "is_success": false
}
```
- 响应示例：
```json
{
  "code": 0,
  "message": "记录已更新",
  "data": {
    "id": 1,
    "student_id": 1001,
    "level_name": "有丝分裂",
    "is_success": 0,
    "failure_count": 4,
    "last_attempt_time": "2025-09-05 11:00:00",
    "created_at": "2025-09-01 08:00:00"
  }
}
```

## 返回字段说明
- **is_success**：最近一次尝试是否成功；布尔写入，整型返回（0/1）
- **failure_count**：累计失败次数；仅在 `is_success=false` 时递增
- **last_attempt_time**：UTC 写入，字符串返回（SQLite 默认格式）

## 相关说明
- 失败次数将用于抽卡概率调整：失败越多，与对应知识点关联的卡牌权重越高。
- 知识映射管理详见 `知识映射管理接口文档.md`。 