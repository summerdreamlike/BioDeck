# 任务管理接口文档

## 目录

- [1. 基本信息](#1-基本信息)
- [2. 任务管理](#2-任务管理)
- [3. 任务分配](#3-任务分配)
- [4. 任务提交](#4-任务提交)
- [5. 任务评分](#5-任务评分)
- [6. 任务统计](#6-任务统计)

---

## 1. 基本信息

- **模块名称**: 任务管理
- **API前缀**: `/api/v1/tasks`
- **功能描述**: 管理教学任务的创建、分配、提交、评分和统计
- **部署说明**: 系统已修复导入路径问题，确保在backend目录下运行

---

## 2. 任务管理

### 2.1 获取任务列表

**接口地址**: `GET /tasks`

**接口描述**: 获取任务列表，支持分页和筛选

**权限要求**: 需要登录

**查询参数**:
- `page`: 页码（默认1）
- `page_size`: 每页大小（默认20）
- `creator_id`: 创建者ID筛选
- `course_id`: 课程ID筛选
- `status`: 任务状态筛选（active/completed/expired）
- `priority`: 优先级筛选（high/medium/low）

**成功响应**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "items": [
      {
        "id": 1,
        "title": "数学作业",
        "description": "完成课本第1-5页习题",
        "course_id": 1,
        "course_name": "数学课",
        "creator_id": 1,
        "creator_name": "张老师",
        "due_date": "2024-01-05T23:59:59Z",
        "status": "active",
        "priority": "medium",
        "total_students": 30,
        "submitted_count": 25,
        "graded_count": 20,
        "created_at": "2024-01-01T12:00:00Z"
      }
    ],
    "total": 50,
    "page": 1,
    "page_size": 20,
    "total_pages": 3
  }
}
```

### 2.2 获取任务详情

**接口地址**: `GET /tasks/{task_id}`

**接口描述**: 获取指定任务的详细信息

**权限要求**: 需要登录

**路径参数**:
- `task_id`: 任务ID

**成功响应**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "id": 1,
    "title": "数学作业",
    "description": "完成课本第1-5页习题",
    "course_id": 1,
    "course_name": "数学课",
    "creator_id": 1,
    "creator_name": "张老师",
    "due_date": "2024-01-05T23:59:59Z",
    "status": "active",
    "priority": "medium",
    "attachments": ["附件1.pdf", "附件2.doc"],
    "requirements": "提交要求说明",
    "total_students": 30,
    "submitted_count": 25,
    "graded_count": 20,
    "created_at": "2024-01-01T12:00:00Z",
    "updated_at": "2024-01-01T12:00:00Z"
  }
}
```

### 2.3 创建任务

**接口地址**: `POST /tasks`

**接口描述**: 创建新的教学任务

**权限要求**: admin、teacher

**请求参数**:
```json
{
  "title": "任务标题",
  "description": "任务描述",
  "course_id": "课程ID",
  "due_date": "截止日期(ISO格式)",
  "priority": "优先级(high/medium/low)",
  "attachments": ["附件文件"],
  "requirements": "提交要求说明"
}
```

**成功响应**:
```json
{
  "success": true,
  "message": "任务创建成功",
  "data": {
    "id": 1,
    "title": "数学作业",
    "course_id": 1,
    "due_date": "2024-01-05T23:59:59Z",
    "status": "active"
  }
}
```

### 2.4 更新任务

**接口地址**: `PUT /tasks/{task_id}`

**接口描述**: 更新任务信息

**权限要求**: 任务创建者或admin

**路径参数**:
- `task_id`: 任务ID

**请求参数**: 同创建任务

**成功响应**:
```json
{
  "success": true,
  "message": "任务更新成功",
  "data": {
    "id": 1,
    "title": "数学作业(更新)",
    "updated_at": "2024-01-01T13:00:00Z"
  }
}
```

### 2.5 删除任务

**接口地址**: `DELETE /tasks/{task_id}`

**接口描述**: 删除任务

**权限要求**: 任务创建者或admin

**路径参数**:
- `task_id`: 任务ID

**成功响应**:
```json
{
  "success": true,
  "message": "任务删除成功"
}
```

---

## 3. 任务分配

### 3.1 分配任务给学生

**接口地址**: `POST /tasks/{task_id}/assign`

**接口描述**: 将任务分配给指定学生

**权限要求**: 任务创建者或admin

**路径参数**:
- `task_id`: 任务ID

**请求参数**:
```json
{
  "student_ids": [1, 2, 3],
  "assign_all": false
}
```

**成功响应**:
```json
{
  "success": true,
  "message": "任务分配成功",
  "data": {
    "assigned_count": 3,
    "students": [
      {
        "id": 1,
        "name": "张三",
        "assigned_at": "2024-01-01T12:00:00Z"
      }
    ]
  }
}
```

### 3.2 获取任务分配的学生列表

**接口地址**: `GET /tasks/{task_id}/students`

**接口描述**: 获取任务已分配的学生列表

**权限要求**: 需要登录

**路径参数**:
- `task_id`: 任务ID

**成功响应**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": [
    {
      "id": 1,
      "name": "张三",
      "student_id": "2024001",
      "assigned_at": "2024-01-01T12:00:00Z",
      "submitted": true,
      "submitted_at": "2024-01-03T10:00:00Z",
      "graded": true,
      "score": 85
    }
  ]
}
```

### 3.3 移除任务分配

**接口地址**: `DELETE /tasks/{task_id}/students/{student_id}`

**接口描述**: 移除学生的任务分配

**权限要求**: 任务创建者或admin

**路径参数**:
- `task_id`: 任务ID
- `student_id`: 学生ID

**成功响应**:
```json
{
  "success": true,
  "message": "任务分配已移除"
}
```

---

## 4. 任务提交

### 4.1 学生提交任务

**接口地址**: `POST /tasks/{task_id}/submit`

**接口描述**: 学生提交任务完成情况

**权限要求**: student

**路径参数**:
- `task_id`: 任务ID

**请求参数**:
```json
{
  "content": "任务完成内容",
  "attachments": ["提交文件"],
  "notes": "备注说明(可选)"
}
```

**成功响应**:
```json
{
  "success": true,
  "message": "任务提交成功",
  "data": {
    "id": 1,
    "task_id": 1,
    "student_id": 1,
    "submitted_at": "2024-01-03T10:00:00Z"
  }
}
```

### 4.2 获取任务提交详情

**接口地址**: `GET /tasks/{task_id}/submissions/{submission_id}`

**接口描述**: 获取任务提交的详细信息

**权限要求**: 提交者、任务创建者或admin

**路径参数**:
- `task_id`: 任务ID
- `submission_id`: 提交ID

**成功响应**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "id": 1,
    "task_id": 1,
    "student_id": 1,
    "student_name": "张三",
    "content": "任务完成内容",
    "attachments": ["提交文件1.pdf", "提交文件2.doc"],
    "notes": "备注说明",
    "submitted_at": "2024-01-03T10:00:00Z",
    "graded": true,
    "score": 85,
    "feedback": "完成得很好，继续努力！",
    "graded_at": "2024-01-04T14:00:00Z"
  }
}
```

### 4.3 更新任务提交

**接口地址**: `PUT /tasks/{task_id}/submissions/{submission_id}`

**接口描述**: 学生更新任务提交内容

**权限要求**: 提交者本人

**路径参数**:
- `task_id`: 任务ID
- `submission_id`: 提交ID

**请求参数**: 同提交任务

**成功响应**:
```json
{
  "success": true,
  "message": "任务提交更新成功",
  "data": {
    "id": 1,
    "updated_at": "2024-01-03T15:00:00Z"
  }
}
```

### 4.4 获取学生的任务提交

**接口地址**: `GET /tasks/{task_id}/my-submission`

**接口描述**: 学生查看自己的任务提交

**权限要求**: student

**路径参数**:
- `task_id`: 任务ID

**成功响应**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "id": 1,
    "content": "任务完成内容",
    "attachments": ["提交文件1.pdf"],
    "notes": "备注说明",
    "submitted_at": "2024-01-03T10:00:00Z",
    "graded": true,
    "score": 85,
    "feedback": "完成得很好，继续努力！"
  }
}
```

---

## 5. 任务评分

### 5.1 教师评分

**接口地址**: `POST /tasks/{task_id}/submissions/{submission_id}/grade`

**接口描述**: 教师对任务提交进行评分

**权限要求**: 任务创建者或admin

**路径参数**:
- `task_id`: 任务ID
- `submission_id`: 提交ID

**请求参数**:
```json
{
  "score": "分数(0-100)",
  "feedback": "评语反馈",
  "grade_notes": "评分备注(可选)"
}
```

**成功响应**:
```json
{
  "success": true,
  "message": "评分成功",
  "data": {
    "id": 1,
    "score": 85,
    "feedback": "完成得很好，继续努力！",
    "graded_at": "2024-01-04T14:00:00Z"
  }
}
```

### 5.2 批量评分

**接口地址**: `POST /tasks/{task_id}/batch-grade`

**接口描述**: 批量对任务提交进行评分

**权限要求**: 任务创建者或admin

**路径参数**:
- `task_id`: 任务ID

**请求参数**:
```json
{
  "grades": [
    {
      "submission_id": 1,
      "score": 85,
      "feedback": "完成得很好"
    },
    {
      "submission_id": 2,
      "score": 90,
      "feedback": "优秀"
    }
  ]
}
```

**成功响应**:
```json
{
  "success": true,
  "message": "批量评分成功",
  "data": {
    "graded_count": 2,
    "results": [
      {
        "submission_id": 1,
        "success": true,
        "score": 85
      }
    ]
  }
}
```

---

## 6. 任务统计

### 6.1 获取任务统计信息

**接口地址**: `GET /tasks/statistics`

**接口描述**: 获取任务相关的统计信息

**权限要求**: admin、teacher

**查询参数**:
- `course_id`: 课程ID筛选
- `start_date`: 开始日期（YYYY-MM-DD）
- `end_date`: 结束日期（YYYY-MM-DD）

**成功响应**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "total_tasks": 50,
    "active_tasks": 20,
    "completed_tasks": 25,
    "expired_tasks": 5,
    "total_submissions": 750,
    "graded_submissions": 600,
    "average_score": 82.5,
    "by_priority": {
      "high": 10,
      "medium": 25,
      "low": 15
    },
    "by_course": [
      {
        "course_id": 1,
        "course_name": "数学课",
        "task_count": 15,
        "submission_count": 225,
        "average_score": 85.2
      }
    ]
  }
}
```

### 6.2 获取任务完成情况

**接口地址**: `GET /tasks/{task_id}/completion`

**接口描述**: 获取指定任务的完成情况统计

**权限要求**: 任务创建者或admin

**路径参数**:
- `task_id`: 任务ID

**成功响应**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "task_id": 1,
    "title": "数学作业",
    "total_students": 30,
    "assigned_students": 30,
    "submitted_count": 25,
    "graded_count": 20,
    "submission_rate": 0.83,
    "grading_rate": 0.8,
    "score_distribution": {
      "90-100": 5,
      "80-89": 8,
      "70-79": 4,
      "60-69": 2,
      "0-59": 1
    },
    "average_score": 82.5
  }
}
```

---

## 7. 错误码说明

| 错误码 | 描述 |
|--------|------|
| VALIDATION_ERROR | 参数验证错误 |
| PERMISSION_DENIED | 权限不足 |
| RESOURCE_NOT_FOUND | 资源不存在 |
| OPERATION_FAILED | 操作失败 |
| TASK_EXPIRED | 任务已过期 |
| ALREADY_SUBMITTED | 任务已提交 |

## 8. 注意事项

1. **任务状态说明**:
   - `active`: 进行中，学生可以提交
   - `completed`: 已完成，所有学生都已提交
   - `expired`: 已过期，超过截止日期

2. **权限控制**:
   - 学生只能查看和操作分配给自己的任务
   - 教师可以管理自己创建的任务
   - 管理员拥有所有权限

3. **提交限制**:
   - 学生只能提交一次任务
   - 在截止日期前可以更新提交内容
   - 截止日期后无法提交或更新

4. **评分规则**:
   - 分数范围为0-100
   - 支持小数点评分
   - 评分后学生可以查看分数和反馈

5. **文件附件**:
   - 支持多种文件格式上传
   - 文件大小限制为50MB
   - 支持批量文件上传 