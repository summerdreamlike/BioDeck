# 消息中心接口文档

## 目录

- [1. 基本信息](#1-基本信息)
- [2. 消息管理](#2-消息管理)
- [3. 消息统计](#3-消息统计)

---

## 1. 基本信息

- **模块名称**: 消息中心
- **API前缀**: `/api/v1/messages`
- **功能描述**: 管理系统内部的消息发送、接收、查看和管理
- **部署说明**: 系统已修复导入路径问题，确保在backend目录下运行

---

## 2. 消息管理

### 2.1 发送消息

**接口地址**: `POST /messages`

**接口描述**: 发送消息给指定用户

**权限要求**: 需要登录

**请求参数**:
```json
{
  "recipient_id": "接收者ID",
  "title": "消息标题",
  "content": "消息内容",
  "type": "消息类型(system/notification/chat)",
  "priority": "优先级(high/medium/low)"
}
```

**成功响应**:
```json
{
  "success": true,
  "message": "消息发送成功",
  "data": {
    "id": 1,
    "sender_id": 1,
    "recipient_id": 2,
    "title": "系统通知",
    "content": "消息内容",
    "type": "system",
    "priority": "high",
    "created_at": "2024-01-01T12:00:00Z"
  }
}
```

### 2.2 获取消息列表

**接口地址**: `GET /messages`

**接口描述**: 获取当前用户的消息列表

**权限要求**: 需要登录

**查询参数**:
- `page`: 页码（默认1）
- `page_size`: 每页大小（默认20）
- `type`: 消息类型筛选
- `is_read`: 是否已读筛选（true/false）
- `priority`: 优先级筛选

**成功响应**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "items": [
      {
        "id": 1,
        "sender_id": 1,
        "sender_name": "张老师",
        "recipient_id": 2,
        "title": "系统通知",
        "content": "消息内容",
        "type": "system",
        "priority": "high",
        "is_read": false,
        "created_at": "2024-01-01T12:00:00Z"
      }
    ],
    "total": 50,
    "page": 1,
    "page_size": 20,
    "total_pages": 3
  }
}
```

### 2.3 获取消息详情

**接口地址**: `GET /messages/{message_id}`

**接口描述**: 获取指定消息的详细信息

**权限要求**: 消息发送者或接收者

**路径参数**:
- `message_id`: 消息ID

**成功响应**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "id": 1,
    "sender_id": 1,
    "sender_name": "张老师",
    "sender_avatar": "头像URL",
    "recipient_id": 2,
    "recipient_name": "李同学",
    "title": "系统通知",
    "content": "消息内容",
    "type": "system",
    "priority": "high",
    "is_read": false,
    "read_at": null,
    "created_at": "2024-01-01T12:00:00Z"
  }
}
```

### 2.4 标记消息已读

**接口地址**: `PUT /messages/{message_id}/read`

**接口描述**: 标记指定消息为已读

**权限要求**: 消息接收者

**路径参数**:
- `message_id`: 消息ID

**成功响应**:
```json
{
  "success": true,
  "message": "消息已标记为已读",
  "data": {
    "id": 1,
    "is_read": true,
    "read_at": "2024-01-01T12:05:00Z"
  }
}
```

### 2.5 批量标记消息已读

**接口地址**: `PUT /messages/read-all`

**接口描述**: 批量标记所有未读消息为已读

**权限要求**: 需要登录

**请求参数**:
```json
{
  "message_ids": [1, 2, 3],
  "mark_all": true
}
```

**成功响应**:
```json
{
  "success": true,
  "message": "批量标记成功",
  "data": {
    "marked_count": 5
  }
}
```

### 2.6 删除消息

**接口地址**: `DELETE /messages/{message_id}`

**接口描述**: 删除指定消息

**权限要求**: 消息发送者或接收者

**路径参数**:
- `message_id`: 消息ID

**成功响应**:
```json
{
  "success": true,
  "message": "消息删除成功"
}
```

### 2.7 获取发送的消息

**接口地址**: `GET /messages/sent`

**接口描述**: 获取当前用户发送的消息列表

**权限要求**: 需要登录

**查询参数**:
- `page`: 页码（默认1）
- `page_size`: 每页大小（默认20）
- `recipient_id`: 接收者ID筛选

**成功响应**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "items": [
      {
        "id": 1,
        "recipient_id": 2,
        "recipient_name": "李同学",
        "title": "系统通知",
        "content": "消息内容",
        "type": "system",
        "is_read": false,
        "created_at": "2024-01-01T12:00:00Z"
      }
    ],
    "total": 30,
    "page": 1,
    "page_size": 20,
    "total_pages": 2
  }
}
```

### 2.8 获取接收的消息

**接口地址**: `GET /messages/received`

**接口描述**: 获取当前用户接收的消息列表

**权限要求**: 需要登录

**查询参数**:
- `page`: 页码（默认1）
- `page_size`: 每页大小（默认20）
- `sender_id`: 发送者ID筛选
- `is_read`: 是否已读筛选

**成功响应**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "items": [
      {
        "id": 1,
        "sender_id": 1,
        "sender_name": "张老师",
        "title": "系统通知",
        "content": "消息内容",
        "type": "system",
        "is_read": false,
        "created_at": "2024-01-01T12:00:00Z"
      }
    ],
    "total": 25,
    "page": 1,
    "page_size": 20,
    "total_pages": 2
  }
}
```

---

## 3. 消息统计

### 3.1 获取未读消息数量

**接口地址**: `GET /messages/unread-count`

**接口描述**: 获取当前用户的未读消息数量

**权限要求**: 需要登录

**成功响应**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "total_unread": 15,
    "by_type": {
      "system": 5,
      "notification": 8,
      "chat": 2
    },
    "by_priority": {
      "high": 3,
      "medium": 8,
      "low": 4
    }
  }
}
```

### 3.2 获取消息统计信息

**接口地址**: `GET /messages/statistics`

**接口描述**: 获取消息相关的统计信息

**权限要求**: 需要登录

**查询参数**:
- `start_date`: 开始日期（YYYY-MM-DD）
- `end_date`: 结束日期（YYYY-MM-DD）

**成功响应**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "total_messages": 150,
    "sent_messages": 80,
    "received_messages": 70,
    "read_messages": 120,
    "unread_messages": 30,
    "daily_stats": [
      {
        "date": "2024-01-01",
        "sent": 5,
        "received": 3,
        "read": 6
      }
    ]
  }
}
```

---

## 4. 错误码说明

| 错误码 | 描述 |
|--------|------|
| VALIDATION_ERROR | 参数验证错误 |
| PERMISSION_DENIED | 权限不足 |
| RESOURCE_NOT_FOUND | 消息不存在 |
| OPERATION_FAILED | 操作失败 |

## 5. 注意事项

1. **消息权限控制**:
   - 用户只能查看自己发送或接收的消息
   - 只有消息接收者可以标记消息为已读
   - 消息发送者和接收者都可以删除消息

2. **消息类型**:
   - `system`: 系统消息，如系统通知、维护通知等
   - `notification`: 通知消息，如作业提醒、考试通知等
   - `chat`: 聊天消息，用户之间的私信

3. **消息优先级**:
   - `high`: 高优先级，需要立即关注
   - `medium`: 中等优先级，正常处理
   - `low`: 低优先级，可稍后处理

4. **消息状态**:
   - 新消息默认为未读状态
   - 标记已读后，`is_read`字段变为true，`read_at`字段记录阅读时间
   - 删除的消息不可恢复

5. **批量操作**:
   - 支持批量标记消息已读
   - 支持按条件筛选消息进行批量操作
   - 批量操作会返回操作结果统计 