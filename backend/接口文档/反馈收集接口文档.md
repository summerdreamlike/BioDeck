# 反馈收集接口文档

## 目录

- [1. 基本信息](#1-基本信息)
- [2. 反馈管理](#2-反馈管理)
- [3. 反馈统计](#3-反馈统计)
- [4. 关键词分析](#4-关键词分析)

---

## 1. 基本信息

- **模块名称**: 反馈收集
- **API前缀**: `/api/v1/feedbacks`
- **功能描述**: 收集和管理学生对教学质量的反馈意见
- **部署说明**: 系统已修复导入路径问题，确保在backend目录下运行

---

## 2. 反馈管理

### 2.1 获取反馈列表

**接口地址**: `GET /feedbacks`

**接口描述**: 获取反馈列表，支持分页和筛选

**权限要求**: admin、teacher

**查询参数**:
- `page`: 页码（默认1）
- `page_size`: 每页大小（默认20）
- `student_id`: 学生ID筛选
- `satisfaction`: 满意度筛选（1-5）
- `start_date`: 开始日期（YYYY-MM-DD）
- `end_date`: 结束日期（YYYY-MM-DD）

**成功响应**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "items": [
      {
        "id": 1,
        "student_id": 1,
        "student_name": "张三",
        "content": "老师讲课很生动，希望能多举一些实际例子",
        "satisfaction": 4,
        "created_at": "2024-01-01T12:00:00Z"
      }
    ],
    "total": 100,
    "page": 1,
    "page_size": 20,
    "total_pages": 5
  }
}
```

### 2.2 获取反馈详情

**接口地址**: `GET /feedbacks/{feedback_id}`

**接口描述**: 获取指定反馈的详细信息

**权限要求**: admin、teacher

**路径参数**:
- `feedback_id`: 反馈ID

**成功响应**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "id": 1,
    "student_id": 1,
    "student_name": "张三",
    "student_avatar": "头像URL",
    "content": "老师讲课很生动，希望能多举一些实际例子",
    "satisfaction": 4,
    "created_at": "2024-01-01T12:00:00Z",
    "updated_at": "2024-01-01T12:00:00Z"
  }
}
```

### 2.3 删除反馈

**接口地址**: `DELETE /feedbacks/{feedback_id}`

**接口描述**: 删除反馈（仅管理员）

**权限要求**: admin

**路径参数**:
- `feedback_id`: 反馈ID

**成功响应**:
```json
{
  "success": true,
  "message": "反馈删除成功"
}
```

---

## 3. 反馈统计

### 3.1 获取反馈统计信息

**接口地址**: `GET /feedbacks/statistics`

**接口描述**: 获取反馈相关的统计信息

**权限要求**: admin、teacher

**查询参数**:
- `start_date`: 开始日期（YYYY-MM-DD）
- `end_date`: 结束日期（YYYY-MM-DD）

**成功响应**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "total_feedbacks": 150,
    "average_satisfaction": 4.2,
    "satisfaction_distribution": {
      "5": 45,
      "4": 60,
      "3": 30,
      "2": 10,
      "1": 5
    },
    "by_class": [
      {
        "class_id": 1,
        "class_name": "数学班",
        "total": 50,
        "average_satisfaction": 4.3,
        "distribution": {
          "5": 20,
          "4": 20,
          "3": 8,
          "2": 1,
          "1": 1
        }
      }
    ],
    "daily_stats": [
      {
        "date": "2024-01-01",
        "count": 5,
        "average_satisfaction": 4.2
      }
    ]
  }
}
```

---

## 4. 关键词分析

### 4.1 分析反馈关键词

**接口地址**: `GET /feedbacks/keywords`

**接口描述**: 分析反馈内容中的关键词频率

**权限要求**: admin、teacher

**查询参数**:
- `start_date`: 开始日期（YYYY-MM-DD）
- `end_date`: 结束日期（YYYY-MM-DD）
- `limit`: 返回关键词数量（默认20）

**成功响应**:
```json
{
  "success": true,
  "message": "分析成功",
  "data": {
    "keywords": [
      {
        "word": "生动",
        "frequency": 25,
        "percentage": 0.167
      },
      {
        "word": "例子",
        "frequency": 20,
        "percentage": 0.133
      },
      {
        "word": "清晰",
        "frequency": 18,
        "percentage": 0.12
      }
    ],
    "total_words": 150,
    "unique_words": 45
  }
}
```

---

## 5. 学生反馈操作

### 5.1 学生提交反馈

**接口地址**: `POST /feedbacks/submit`

**接口描述**: 学生提交反馈意见

**权限要求**: student

**请求参数**:
```json
{
  "content": "反馈内容",
  "satisfaction": "满意度(1-5)"
}
```

**成功响应**:
```json
{
  "success": true,
  "message": "反馈提交成功",
  "data": {
    "id": 1,
    "content": "反馈内容",
    "satisfaction": 4,
    "created_at": "2024-01-01T12:00:00Z"
  }
}
```

### 5.2 学生查看自己的反馈

**接口地址**: `GET /feedbacks/my`

**接口描述**: 学生查看自己提交的所有反馈

**权限要求**: student

**查询参数**:
- `page`: 页码（默认1）
- `page_size`: 每页大小（默认20）

**成功响应**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "items": [
      {
        "id": 1,
        "content": "老师讲课很生动，希望能多举一些实际例子",
        "satisfaction": 4,
        "created_at": "2024-01-01T12:00:00Z"
      }
    ],
    "total": 5,
    "page": 1,
    "page_size": 20,
    "total_pages": 1
  }
}
```

### 5.3 学生更新反馈

**接口地址**: `PUT /feedbacks/{feedback_id}`

**接口描述**: 学生更新自己的反馈内容

**权限要求**: 反馈提交者本人

**路径参数**:
- `feedback_id`: 反馈ID

**请求参数**:
```json
{
  "content": "更新后的反馈内容",
  "satisfaction": "更新后的满意度(1-5)"
}
```

**成功响应**:
```json
{
  "success": true,
  "message": "反馈更新成功",
  "data": {
    "id": 1,
    "content": "更新后的反馈内容",
    "satisfaction": 5,
    "updated_at": "2024-01-01T13:00:00Z"
  }
}
```

---

## 6. 错误码说明

| 错误码 | 描述 |
|--------|------|
| VALIDATION_ERROR | 参数验证错误 |
| PERMISSION_DENIED | 权限不足 |
| RESOURCE_NOT_FOUND | 反馈不存在 |
| OPERATION_FAILED | 操作失败 |
| FEEDBACK_LIMIT_EXCEED | 反馈提交频率超限 |

## 7. 注意事项

1. **满意度评分说明**:
   - 1分：非常不满意
   - 2分：不满意
   - 3分：一般
   - 4分：满意
   - 5分：非常满意

2. **反馈提交限制**:
   - 每个学生24小时内只能提交一次反馈
   - 反馈内容不能为空，长度限制在500字以内
   - 满意度必须是1-5之间的整数

3. **权限控制**:
   - 学生只能查看和修改自己的反馈
   - 教师可以查看所有反馈和统计数据
   - 只有管理员可以删除反馈

4. **关键词分析**:
   - 系统会自动过滤停用词（如"的"、"了"、"是"等）
   - 支持中文和英文关键词识别
   - 关键词按出现频率降序排列

5. **数据统计**:
   - 支持按时间范围统计
   - 支持按班级分组统计
   - 提供详细的满意度分布数据

6. **反馈保护**:
   - 反馈内容对学生个人信息进行脱敏处理
   - 删除反馈为软删除，保留历史记录
   - 支持反馈内容的批量导出功能 