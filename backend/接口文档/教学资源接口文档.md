# 教学资源接口文档

## 目录

- [1. 基本信息](#1-基本信息)
- [2. 教学资源管理](#2-教学资源管理)
- [3. 分类管理](#3-分类管理)
- [4. 标签管理](#4-标签管理)

---

## 1. 基本信息

- **模块名称**: 教学资源管理
- **API前缀**: `/api/v1/materials`
- **功能描述**: 管理教学资源的上传、分类、标签和查看
- **部署说明**: 系统已修复导入路径问题，确保在backend目录下运行

---

## 2. 教学资源管理

### 2.1 获取教学资源列表

**接口地址**: `GET /materials`

**接口描述**: 获取教学资源列表，支持分页、筛选和排序

**权限要求**: 无需认证

**查询参数**:
- `page`: 页码（默认1）
- `page_size`: 每页大小（默认12）
- `query`: 关键词搜索
- `type`: 资源类型筛选
- `category_id`: 分类ID筛选
- `tag_id`: 标签ID筛选
- `sort_by`: 排序方式（created_at, view_count, download_count）

**成功响应**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "items": [
      {
        "id": 1,
        "title": "数学公式手册",
        "description": "高中数学常用公式汇总",
        "type": "pdf",
        "file_url": "文件下载URL",
        "file_size": 2048576,
        "view_count": 150,
        "download_count": 45,
        "category_id": 1,
        "category_name": "数学",
        "tags": ["公式", "手册"],
        "uploader_id": 1,
        "uploader_name": "张老师",
        "created_at": "2024-01-01T12:00:00Z"
      }
    ],
    "total": 100,
    "page": 1,
    "page_size": 12,
    "total_pages": 9
  }
}
```

### 2.2 获取教学资源详情

**接口地址**: `GET /materials/{material_id}`

**接口描述**: 获取指定教学资源的详细信息

**权限要求**: 无需认证

**路径参数**:
- `material_id`: 资源ID

**成功响应**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "id": 1,
    "title": "数学公式手册",
    "description": "高中数学常用公式汇总",
    "type": "pdf",
    "file_url": "文件下载URL",
    "file_size": 2048576,
    "view_count": 150,
    "download_count": 45,
    "category_id": 1,
    "category_name": "数学",
    "tags": ["公式", "手册"],
    "uploader_id": 1,
    "uploader_name": "张老师",
    "created_at": "2024-01-01T12:00:00Z",
    "updated_at": "2024-01-01T12:00:00Z"
  }
}
```

### 2.3 上传教学资源

**接口地址**: `POST /materials`

**接口描述**: 上传新的教学资源

**权限要求**: admin、teacher

**请求参数**:
```json
{
  "title": "资源标题",
  "description": "资源描述",
  "type": "资源类型(pdf/doc/video/image)",
  "category_id": "分类ID",
  "tag_ids": [1, 2, 3],
  "file": "文件对象"
}
```

**成功响应**:
```json
{
  "success": true,
  "message": "资源上传成功",
  "data": {
    "id": 1,
    "title": "数学公式手册",
    "file_url": "文件URL",
    "file_size": 2048576
  }
}
```

### 2.4 更新教学资源

**接口地址**: `PUT /materials/{material_id}`

**接口描述**: 更新教学资源信息

**权限要求**: 资源上传者或admin

**路径参数**:
- `material_id`: 资源ID

**请求参数**:
```json
{
  "title": "资源标题",
  "description": "资源描述",
  "category_id": "分类ID",
  "tag_ids": [1, 2, 3]
}
```

**成功响应**:
```json
{
  "success": true,
  "message": "资源更新成功",
  "data": {
    "id": 1,
    "title": "数学公式手册(更新)",
    "updated_at": "2024-01-01T13:00:00Z"
  }
}
```

### 2.5 删除教学资源

**接口地址**: `DELETE /materials/{material_id}`

**接口描述**: 删除教学资源

**权限要求**: 资源上传者或admin

**路径参数**:
- `material_id`: 资源ID

**成功响应**:
```json
{
  "success": true,
  "message": "教学资源删除成功"
}
```

### 2.6 下载教学资源

**接口地址**: `GET /materials/{material_id}/download`

**接口描述**: 下载教学资源文件

**权限要求**: 需要登录

**路径参数**:
- `material_id`: 资源ID

**成功响应**: 文件流

---

## 上传课件

### 接口描述

上传课件文件（PPT、PDF、Word、Excel等）

### 请求URL

`POST /api/v1/materials/upload/courseware`

### 请求方式

`POST`

### 权限要求

需要认证，仅限教师和管理员

### 请求参数

| 参数名 | 必选 | 类型 | 说明 |
| ------ | ---- | ---- | ---- |
| file | 是 | file | 课件文件，支持的格式：ppt, pptx, pdf, doc, docx, xls, xlsx，大小限制：50MB |
| category_id | 否 | int | 分类ID |
| description | 否 | string | 课件描述 |
| tags | 否 | string | 标签ID数组的JSON字符串，例如：`"[1, 2, 3]"` |

### 请求示例

```
POST /api/v1/materials/upload/courseware
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="光合作用.pptx"
Content-Type: application/vnd.openxmlformats-officedocument.presentationml.presentation

(二进制文件内容)
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="category_id"

1
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="description"

光合作用相关课件
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="tags"

[1, 3, 5]
------WebKitFormBoundary7MA4YWxkTrZu0gW--
```

### 返回参数

| 参数名 | 类型 | 说明 |
| ------ | ---- | ---- |
| code | int | 状态码，0表示成功 |
| message | string | 提示信息 |
| data | object | 课件信息 |

### 返回示例

```json
{
  "code": 0,
  "message": "课件上传成功",
  "data": {
    "id": 123,
    "name": "光合作用.pptx",
    "type": "courseware",
    "url": "/uploads/courseware/abc123def456_光合作用.pptx",
    "thumbnail": null,
    "size": 2048000,
    "uploader_id": 1,
    "uploader_name": "张老师",
    "category_id": 1,
    "category_name": "生物学",
    "description": "光合作用相关课件",
    "view_count": 0,
    "upload_time": "2023-09-15 14:30:00",
    "tags": [
      {
        "id": 1,
        "name": "光合作用"
      },
      {
        "id": 3,
        "name": "植物生理"
      },
      {
        "id": 5,
        "name": "高中生物"
      }
    ]
  }
}
```

### 错误码

| 错误码 | 说明 |
| ------ | ---- |
| 1001 | 参数错误 |
| 1002 | 权限不足 |
| 1003 | 资源不存在 |
| 1004 | 操作失败 |

### 错误示例

```json
{
  "code": 1001,
  "message": "不支持的文件类型，仅支持PPT、PDF、Word和Excel文件",
  "data": null
}
```

```json
{
  "code": 1001,
  "message": "文件大小超过限制（最大50MB）",
  "data": null
}
```

---

## 3. 分类管理

### 3.1 获取分类列表

**接口地址**: `GET /materials/categories`

**接口描述**: 获取所有教学资源分类

**权限要求**: 无需认证

**成功响应**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": [
    {
      "id": 1,
      "name": "数学",
      "description": "数学相关资源",
      "resource_count": 25,
      "created_at": "2024-01-01T12:00:00Z"
    }
  ]
}
```

### 3.2 获取分类详情

**接口地址**: `GET /materials/categories/{category_id}`

**接口描述**: 获取指定分类的详细信息

**权限要求**: 无需认证

**路径参数**:
- `category_id`: 分类ID

**成功响应**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "id": 1,
    "name": "数学",
    "description": "数学相关资源",
    "resource_count": 25,
    "created_at": "2024-01-01T12:00:00Z"
  }
}
```

### 3.3 创建分类

**接口地址**: `POST /materials/categories`

**接口描述**: 创建新的教学资源分类

**权限要求**: admin、teacher

**请求参数**:
```json
{
  "name": "分类名称",
  "description": "分类描述"
}
```

**成功响应**:
```json
{
  "success": true,
  "message": "分类创建成功",
  "data": {
    "id": 1,
    "name": "物理",
    "description": "物理相关资源"
  }
}
```

### 3.4 更新分类

**接口地址**: `PUT /materials/categories/{category_id}`

**接口描述**: 更新分类信息

**权限要求**: admin、teacher

**路径参数**:
- `category_id`: 分类ID

**请求参数**: 同创建分类

**成功响应**:
```json
{
  "success": true,
  "message": "分类更新成功",
  "data": {
    "id": 1,
    "name": "物理(更新)",
    "description": "物理相关资源"
  }
}
```

### 3.5 删除分类

**接口地址**: `DELETE /materials/categories/{category_id}`

**接口描述**: 删除分类

**权限要求**: admin、teacher

**路径参数**:
- `category_id`: 分类ID

**成功响应**:
```json
{
  "success": true,
  "message": "分类删除成功"
}
```

---

## 4. 标签管理

### 4.1 获取标签列表

**接口地址**: `GET /materials/tags`

**接口描述**: 获取所有教学资源标签

**权限要求**: 无需认证

**成功响应**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": [
    {
      "id": 1,
      "name": "公式",
      "description": "数学公式相关",
      "resource_count": 15,
      "created_at": "2024-01-01T12:00:00Z"
    }
  ]
}
```

### 4.2 获取标签详情

**接口地址**: `GET /materials/tags/{tag_id}`

**接口描述**: 获取指定标签的详细信息

**权限要求**: 无需认证

**路径参数**:
- `tag_id`: 标签ID

**成功响应**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "id": 1,
    "name": "公式",
    "description": "数学公式相关",
    "resource_count": 15,
    "created_at": "2024-01-01T12:00:00Z"
  }
}
```

### 4.3 创建标签

**接口地址**: `POST /materials/tags`

**接口描述**: 创建新的教学资源标签

**权限要求**: admin、teacher

**请求参数**:
```json
{
  "name": "标签名称",
  "description": "标签描述"
}
```

**成功响应**:
```json
{
  "success": true,
  "message": "标签创建成功",
  "data": {
    "id": 1,
    "name": "手册",
    "description": "学习手册相关"
  }
}
```

### 4.4 更新标签

**接口地址**: `PUT /materials/tags/{tag_id}`

**接口描述**: 更新标签信息

**权限要求**: admin、teacher

**路径参数**:
- `tag_id`: 标签ID

**请求参数**: 同创建标签

**成功响应**:
```json
{
  "success": true,
  "message": "标签更新成功",
  "data": {
    "id": 1,
    "name": "手册(更新)",
    "description": "学习手册相关"
  }
}
```

### 4.5 删除标签

**接口地址**: `DELETE /materials/tags/{tag_id}`

**接口描述**: 删除标签

**权限要求**: admin、teacher

**路径参数**:
- `tag_id`: 标签ID

**成功响应**:
```json
{
  "success": true,
  "message": "标签删除成功"
}
```

---

## 5. 错误码说明

| 错误码 | 描述 |
|--------|------|
| VALIDATION_ERROR | 参数验证错误 |
| PERMISSION_DENIED | 权限不足 |
| RESOURCE_NOT_FOUND | 资源不存在 |
| OPERATION_FAILED | 操作失败 |

## 6. 注意事项

1. **文件上传限制**:
   - 支持的文件类型：PDF、DOC、视频、图片
   - 最大文件大小：100MB
   - 文件命名：系统自动生成安全文件名

2. **权限控制**:
   - 学生只能查看和下载资源
   - 教师可以上传、更新、删除自己上传的资源
   - 管理员拥有所有权限

3. **资源统计**:
   - 每次访问资源时，浏览次数自动+1
   - 每次下载资源时，下载次数自动+1

4. **分类和标签**:
   - 分类用于主要分类，标签用于细分类
   - 一个资源只能属于一个分类，但可以有多个标签
   - 删除分类或标签前，需要确保没有资源使用它们 