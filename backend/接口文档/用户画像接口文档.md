# 用户画像功能接口文档

## 概述

用户画像功能基于学生在课件学习中的数据，分析并生成个性化的用户特征画像，包括学习能力、学习行为和学习偏好三个维度。

## 功能特点

### 1. 学习能力画像
- **平均完成率**：基于学习数据的完成情况
- **平均准确率**：基于答题和练习的准确程度
- **平均专注度**：基于学习过程中的专注表现
- **平均成绩**：基于各类测试和作业成绩

### 2. 学习行为画像
- **出勤率**：基于课堂出勤记录
- **学习风格**：专注型、稳定型、波动型、需要关注

### 3. 学习偏好画像
- **课件类型偏好**：视频、文档、图片等
- **学习时间偏好**：早晨、下午、晚上

## API接口

### 1. 获取用户画像

**接口地址：** `GET /api/v1/profile/{user_id}`

**请求参数：**
- `user_id` (路径参数): 用户ID

**响应示例：**
```json
{
    "code": 200,
    "message": "获取用户画像成功",
    "data": {
        "id": 1,
        "user_id": 123,
        "learning_level": "良好",
        "study_style": "专注型",
        "preferred_time": "afternoon",
        "preferred_material_type": "video",
        "attendance_rate": 85.5,
        "avg_completion_rate": 78.3,
        "avg_accuracy_rate": 82.1,
        "avg_focus_rate": 75.8,
        "avg_score": 76.5,
        "created_at": "2024-01-01 10:00:00",
        "last_updated": "2024-01-15 14:30:00"
    }
}
```

### 2. 生成用户画像

**接口地址：** `POST /api/v1/profile/{user_id}/generate`

**请求参数：**
- `user_id` (路径参数): 用户ID

**响应示例：**
```json
{
    "code": 200,
    "message": "生成用户画像成功",
    "data": {
        "learning_level": "良好",
        "study_style": "专注型",
        "preferred_time": "afternoon",
        "preferred_material_type": "video",
        "attendance_rate": 85.5,
        "avg_completion_rate": 78.3,
        "avg_accuracy_rate": 82.1,
        "avg_focus_rate": 75.8,
        "avg_score": 76.5
    }
}
```

### 3. 更新用户画像

**接口地址：** `PUT /api/v1/profile/{user_id}/update`

**请求参数：**
- `user_id` (路径参数): 用户ID

**响应示例：**
```json
{
    "code": 200,
    "message": "更新用户画像成功",
    "data": {
        "learning_level": "优秀",
        "study_style": "专注型",
        "preferred_time": "morning",
        "preferred_material_type": "document",
        "attendance_rate": 92.0,
        "avg_completion_rate": 88.5,
        "avg_accuracy_rate": 89.2,
        "avg_focus_rate": 82.1,
        "avg_score": 85.7
    }
}
```

### 4. 获取所有用户画像

**接口地址：** `GET /api/v1/profiles`

**响应示例：**
```json
{
    "code": 200,
    "message": "获取所有用户画像成功",
    "data": [
        {
            "id": 1,
            "user_id": 123,
            "user_name": "张三",
            "username": "zhangsan",
            "learning_level": "良好",
            "study_style": "专注型",
            "preferred_time": "afternoon",
            "preferred_material_type": "video",
            "attendance_rate": 85.5,
            "avg_completion_rate": 78.3,
            "avg_accuracy_rate": 82.1,
            "avg_focus_rate": 75.8,
            "avg_score": 76.5,
            "last_updated": "2024-01-15 14:30:00"
        }
    ]
}
```

### 5. 分析用户画像（不保存）

**接口地址：** `GET /api/v1/profile/{user_id}/analysis`

**请求参数：**
- `user_id` (路径参数): 用户ID

**响应示例：**
```json
{
    "code": 200,
    "message": "分析用户画像成功",
    "data": {
        "learning_level": "良好",
        "study_style": "专注型",
        "preferred_time": "afternoon",
        "preferred_material_type": "video",
        "attendance_rate": 85.5,
        "avg_completion_rate": 78.3,
        "avg_accuracy_rate": 82.1,
        "avg_focus_rate": 75.8,
        "avg_score": 76.5
    }
}
```

## 画像标签说明

### 学习水平 (learning_level)
- **优秀**：平均成绩 ≥ 85 且 完成率 ≥ 90%
- **良好**：平均成绩 ≥ 70 且 完成率 ≥ 75%
- **一般**：平均成绩 ≥ 60 且 完成率 ≥ 60%
- **需要提升**：其他情况

### 学习风格 (study_style)
- **专注型**：专注度 ≥ 80% 且 出勤率 ≥ 90%
- **稳定型**：专注度 ≥ 70% 且 出勤率 ≥ 80%
- **波动型**：专注度 ≥ 60% 且 出勤率 ≥ 70%
- **需要关注**：其他情况

### 学习时间偏好 (preferred_time)
- **morning**：平均学习时间 < 12点
- **afternoon**：平均学习时间 12-18点
- **evening**：平均学习时间 ≥ 18点
- **unknown**：无学习记录

## 使用说明

### 1. 初始化
运行初始化脚本创建数据库表：
```bash
python init_user_profile.py
```

### 2. 生成画像
首次使用时，调用生成接口：
```bash
POST /api/v1/profile/123/generate
```

### 3. 获取画像
获取已生成的用户画像：
```bash
GET /api/v1/profile/123
```

### 4. 更新画像
当用户有新的学习数据时，更新画像：
```bash
PUT /api/v1/profile/123/update
```

## 注意事项

1. 用户画像基于最近30条学习记录进行分析
2. 画像数据会定期更新，建议每周更新一次
3. 新用户首次生成画像可能需要一些时间
4. 所有接口都需要登录认证
5. 画像分析是简化版本，适合小项目使用 